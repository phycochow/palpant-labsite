<p>Compare your protocol against the compiled dataset using the associated ranges of outcome-enriched protocol features.</p>

<!-- Progress Bar at the top -->
<div class="benchmark-progress-container">
  <div class="benchmark-progress-bar">
    <div class="progress-segment" id="protocol-progress">
      <div class="progress-indicator">1</div>
      <div class="progress-label">Protocol</div>
    </div>
    <div class="progress-segment" id="experimental-progress">
      <div class="progress-indicator">2</div>
      <div class="progress-label">Experimental Data</div>
    </div>
    <div class="progress-segment" id="purpose-progress">
      <div class="progress-indicator">3</div>
      <div class="progress-label">Protocol Purpose</div>
    </div>
  </div>
</div>

<div class="search-row">
  <!-- Left Panel: User Protocol Input -->
  <div class="search-ui-container wizard-panel">
    <div class="step-header">
      <div class="step-number">1</div>
      <h3>Your Protocol</h3>
      <div class="step-status" id="protocol-step-status">Incomplete</div>
    </div>
    <p>Upload your protocol or select features (choose one method)</p>
    <div class="upload-area mb-3">
      <p>Drag and drop your protocol file here</p>
      <input type="file" id="protocol-file" accept=".pdf" style="display: none;">
      <button class="btn btn-secondary" id="browse-button">Browse Files</button>
    </div>
    <div class="or-separator"><span>OR</span></div>
    <form id="benchmark-form-features" class="mt-3">
      <div class="search-ui-form-group">
        <label for="benchmark-key-dropdown-features" class="search-ui-label">Feature Category</label>
        <select id="benchmark-key-dropdown-features" name="category" class="search-ui-select">
          <option value="">-- Select Feature Category --</option>
          {% for category in CausalFeatureCategories %}
            <option value="{{ category }}">{{ category }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="search-ui-form-group">
        <label class="search-ui-label">Select features of your protocol:</label>
        <div id="benchmark-checkbox-container-features" class="search-ui-checkbox-container search-ui-hidden">
          <p id="benchmark-loading-message-features">Please select a category first...</p>
        </div>
        <div class="search-ui-selection-summary" id="benchmark-selection-summary-features"></div>
      </div>
    </form>
  </div>

  <!-- Middle Panel: Experimental Measurements and Protocol Purpose -->
  <div class="search-ui-container wizard-panel">
    <div class="step-header">
      <div class="step-number">2</div>
      <div class="step-number">3</div>
      <h3>Experimental Data & Purpose</h3>
      <div class="step-status" id="experiment-step-status">Incomplete</div>
    </div>
    <p>Upload your experimental measurements (required)</p>
    <div class="upload-area required-upload mb-3">
      <div class="completion-marker" id="experimental-file-marker"><span class="checkmark">✓</span></div>
      <p><strong>Required:</strong> Upload your experimental measurements</p>
      <input type="file" id="experimental-file" accept=".pdf" style="display: none;">
      <button class="btn btn-secondary" id="experimental-browse-button">Upload Measurements</button>
    </div>
    <p>Select the purpose of your protocol (required)</p>
    <form id="benchmark-form-purpose">
      <div class="completion-marker" id="purpose-marker"><span class="checkmark">✓</span></div>
      <div class="search-ui-form-group">
        <label for="benchmark-key-dropdown-purpose" class="search-ui-label">Protocol Purpose</label>
        <select id="benchmark-key-dropdown-purpose" name="category" class="search-ui-select">
          <option value="">-- Select Protocol Purpose (Required) --</option>
          {% for category in TargetParameters %}
            <option value="{{ category }}">{{ category }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="search-ui-form-group">
        <label class="search-ui-label">What is the protocol's purpose/application?:</label>
        <div id="benchmark-checkbox-container-purpose" class="search-ui-checkbox-container search-ui-hidden">
          <p id="benchmark-loading-message-purpose">Please select a category first...</p>
        </div>
        <div class="search-ui-selection-summary" id="benchmark-selection-summary-purpose"></div>
      </div>
    </form>
  </div>

  <!-- Right Panel: Benchmark Protocols -->
  <div class="search-ui-container wizard-panel">
    <div class="step-header">
      <div class="step-number">4</div>
      <h3>Benchmark Against</h3>
      <div class="step-status optional-step">Optional</div>
    </div>
    <p>Upload reference protocol + data pairs (optional, up to 2 pairs)</p>

    <div id="reference-pairs-container">
      <!-- JS will inject Reference Pair blocks here -->
    </div>

    <button id="add-reference-btn" class="btn btn-link" style="display: none;">+ Add Another Reference Pair</button>

    <div class="or-separator"><span>OR</span></div>
    <div class="search-ui-form-group mt-3">
      <label class="search-ui-label">Select protocols from database (max 5):</label>
      <div class="search-ui-checkbox-container" id="protocol-id-container" style="max-height: 200px; overflow-y: auto;">
        <!-- JS populates 001–322 -->
      </div>
      <div class="search-ui-selection-summary" id="benchmark-selection-summary-protocols"></div>
    </div>
  </div>
</div>

<!-- Submit button -->
<div class="global-submit-container">
  <button id="benchmark-submit-button" class="btn btn-primary">Benchmark Protocol</button>
  <p class="text-muted mt-2 small">Note: Your protocol, experimental data, and protocol purpose are all required</p>
</div>

<!-- Combined Results Container - Now using just a container for styling -->
<div id="benchmark-results-container" class="well" style="display: none; margin-top: 20px;">
  <div id="benchmark-status-message" class="benchmark-status"></div>
  <!-- The radar chart will be added here by JavaScript with our new compact layout -->
</div>

<!-- Include Chart.js for radar chart visualization -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>